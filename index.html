<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Godplace Panel</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* Custom styles */
        .auth-container {
            max-width: 450px;
            margin: 50px auto;
            padding: 40px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 24px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .auth-tab.active {
            color: #d4af37;
            border-bottom-color: #d4af37;
            font-weight: 500;
        }
        
        .hidden {
            display: none !important;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            border: none;
            gap: 8px;
        }
        
        .btn-primary {
            background: #d4af37;
            color: white;
            border: 1px solid #d4af37;
        }
        
        .btn-primary:hover {
            background: #b8941f;
        }
        
        .btn-outline {
            background: transparent;
            color: #d4af37;
            border: 1px solid #d4af37;
        }
        
        .btn-outline:hover {
            background: #d4af37;
            color: white;
        }
        
        .btn-outline.active {
            background: #d4af37;
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-danger {
            background: #dc2626;
            color: white;
            border: 1px solid #dc2626;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
            border: 1px solid #10b981;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }
        
        .alert {
            padding: 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            margin-top: 16px;
        }
        
        .alert-error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }
        
        .alert-success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
        }
        
        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }
        
        .card-header {
            padding: 24px 24px 0 24px;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #d4af37;
            margin-bottom: 8px;
        }
        
        .card-description {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .card-content {
            padding: 24px;
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 500;
            margin: 2px;
        }
        
        .badge-active {
            background: #d4af37;
            color: white;
        }
        
        .badge-inactive {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .badge-admin {
            background: #d4af37;
            color: white;
        }
        
        .badge-modo {
            background: #10b981;
            color: white;
        }
        
        .user-info {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .logs {
            background: #fffbea;
            border: 1px solid #d4af37;
            border-radius: 6px;
            padding: 16px;
            font-family: monospace;
            font-size: 0.875rem;
            color: #6b5e00;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 12px;
            padding: 8px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 4px;
            border-left: 3px solid #d4af37;
        }
        
        .user-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .user-item:hover {
            background: #f9fafb;
        }
        
        .grid {
            display: grid;
            gap: 16px;
        }
        
        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }
        
        .grid-cols-5 {
            grid-template-columns: repeat(5, 1fr);
        }
        
        @media (max-width: 768px) {
            .grid-cols-2, .grid-cols-3, .grid-cols-4, .grid-cols-5 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .grid-cols-2, .grid-cols-3, .grid-cols-4, .grid-cols-5 {
                grid-template-columns: 1fr;
            }
        }
        
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #d4af37;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .channel-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 4px 0;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .channel-item:hover {
            background: #f9fafb;
            border-color: #d4af37;
        }

        .channel-item.selected {
            background: #d4af37;
            color: white;
            border-color: #d4af37;
        }

        .channel-type {
            margin-right: 8px;
            font-size: 1.2em;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="min-h-screen flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600">Chargement...</p>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="authScreen" class="auth-container hidden">
        <div class="text-center mb-8">
            <div class="text-4xl mb-4">üîê</div>
            <h1 class="text-2xl font-bold text-yellow-600 mb-2">Godplace Panel</h1>
            <p class="text-gray-600">Connexion ou inscription requise</p>
        </div>

        <!-- Auth Tabs -->
        <div class="auth-tabs">
            <div class="auth-tab active" data-tab="login">Connexion</div>
            <div class="auth-tab" data-tab="register">Inscription</div>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" id="loginEmail" class="form-input" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                <input type="password" id="loginPassword" class="form-input" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Pseudo Discord</label>
                <input type="text" id="loginDiscordPseudo" class="form-input" placeholder="VotrePseudo#1234" required>
            </div>
            <button type="submit" class="btn btn-primary w-full">
                üöÄ Se connecter
            </button>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="space-y-4 hidden">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" id="registerEmail" class="form-input" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                <input type="password" id="registerPassword" class="form-input" minlength="6" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Confirmer le mot de passe</label>
                <input type="password" id="registerPasswordConfirm" class="form-input" minlength="6" required>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Pseudo Discord</label>
                <input type="text" id="registerDiscordPseudo" class="form-input" placeholder="VotrePseudo#1234" required>
                <p class="text-xs text-gray-500 mt-1">‚ö†Ô∏è Votre pseudo Discord doit √™tre autoris√© par un mod√©rateur</p>
            </div>
            <button type="submit" class="btn btn-primary w-full">
                üìù S'inscrire
            </button>
        </form>

        <div id="authError" class="alert alert-error hidden"></div>
        <div id="authSuccess" class="alert alert-success hidden"></div>
    </div>

    <!-- Main Panel -->
    <div id="mainPanel" class="max-w-6xl mx-auto p-6 space-y-8 hidden">
        <!-- User Info -->
        <div class="user-info">
            <div class="flex items-center space-x-4">
                <div class="text-2xl">üë§</div>
                <div>
                    <div class="font-medium" id="userEmail"></div>
                    <div class="text-sm text-gray-500" id="userDiscord"></div>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <span id="adminBadge" class="badge badge-admin hidden">Admin</span>
                <span id="modoBadge" class="badge badge-modo hidden">Mod√©rateur</span>
                <button id="logoutBtn" class="btn btn-danger">
                    üö™ D√©connexion
                </button>
            </div>
        </div>

        <!-- Header -->
        <div class="text-center">
            <h1 class="text-4xl font-bold text-yellow-600 mb-2">Godplace Panel</h1>
            <p class="text-gray-600 mb-4">Panneau d'administration</p>
            <button id="testBtn" class="btn btn-success">
                üîß Tester la connexion
            </button>
        </div>

        <!-- Authorized Users Management -->
        <div id="authorizedUsersSection" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">üë• Gestion des utilisateurs autoris√©s</h2>
                <p class="card-description">G√©rer la liste des pseudos Discord autoris√©s</p>
            </div>
            <div class="card-content">
                <div class="flex space-x-2 mb-4">
                    <input type="text" id="newUserPseudo" class="form-input flex-1" placeholder="Pseudo Discord (ex: User#1234)">
                    <button id="addUserBtn" class="btn btn-success">
                        ‚ûï Ajouter
                    </button>
                </div>
                <div id="authorizedUsersList" class="user-list">
                    <div class="p-5 text-center text-gray-500">Chargement des utilisateurs autoris√©s...</div>
                </div>
            </div>
        </div>

        <!-- Logs Section -->
        <div id="logsSection" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">üìã Logs des actions</h2>
                <p class="card-description">Historique des actions effectu√©es</p>
            </div>
            <div class="card-content">
                <div id="logs" class="logs">Chargement des logs...</div>
            </div>
        </div>

        <!-- Back Button -->
        <button id="backBtn" class="btn btn-outline hidden">
            ‚Üê Retour
        </button>

        <!-- Main Category Selection -->
        <div id="mainView" class="card">
            <div class="card-header">
                <h2 class="card-title">1. Choisissez une cat√©gorie</h2>
                <p class="card-description">S√©lectionnez la cat√©gorie de contenu √† envoyer</p>
            </div>
            <div class="card-content">
                <select id="categorySelect" class="form-input">
                    <option value="">-- S√©lectionnez une cat√©gorie --</option>
                    <option value="Bandeaux">Bandeaux</option>
                    <option value="mondeEnDeclin">Le Monde en D√©clin</option>
                    <option value="gagneCoeurChrist">Gagne le c≈ìur du Christ</option>
                    <option value="loueAvecTonArt">Loue avec ton art</option>
                    <option value="chaineSacree">Cha√Æne sacr√©e</option>
                    <option value="savoirChretien">Savoir chr√©tien</option>
                    <option value="jePrefere">Je pr√©f√®re</option>
                    <option value="jeDebats">Je d√©bats</option>
                    <option value="composeTonChant">Compose ton chant</option>
                    <option value="priereEnChoeur">Pri√®re en ch≈ìur</option>
                    <option value="quiSuisJeBiblique">Qui suis-je biblique</option>
                    <option value="comprendreApocalypse">Comprendre l'apocalypse</option>
                    <option value="bibleIllustree">LA Bible illustr√©e</option>
                    <option value="cinemaChretien">Cin√©ma Chr√©tien</option>
                    <option value="jeux">Jeux</option>
                </select>
            </div>
        </div>

        <!-- Games Selection -->
        <div id="gamesView" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">Choisissez un jeu</h2>
                <p class="card-description">S√©lectionnez le type de jeu</p>
            </div>
            <div class="card-content">
                <div class="grid grid-cols-2 gap-4">
                    <button class="btn btn-outline h-20 text-lg" data-game="grilleDeLumiere">
                        Grille de lumi√®re
                    </button>
                    <button class="btn btn-outline h-20 text-lg" data-game="eclaireurs">
                        √âclaireurs
                    </button>
                </div>
            </div>
        </div>

        <!-- Week Selection -->
        <div id="weekView" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">2. Choisissez une option</h2>
                <p id="weekDescription" class="card-description">S√©lectionnez une option</p>
            </div>
            <div class="card-content">
                <div id="weekButtons" class="grid grid-cols-5 gap-2"></div>
            </div>
        </div>

        <!-- Image Preview -->
        <div id="previewView" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">üëÅÔ∏è 3. Aper√ßu</h2>
                <p class="card-description">Pr√©visualisation de l'image s√©lectionn√©e</p>
            </div>
            <div class="card-content">
                <div class="text-center">
                    <img id="previewImage" src="/placeholder.svg" alt="Aper√ßu de l'image s√©lectionn√©e" 
                         class="max-w-full h-auto border-2 border-yellow-600 rounded-lg shadow-lg mx-auto" 
                         style="max-height: 400px;">
                </div>
            </div>
        </div>

        <!-- Server Selection -->
        <div id="serverView" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">4. Choisissez un serveur Discord</h2>
                <p class="card-description">S√©lectionnez le serveur Discord cible</p>
            </div>
            <div class="card-content">
                <input type="text" id="serverIdInput" class="form-input mb-4" placeholder="ID du serveur Discord (ex: 1234567890123456789)">
                <button id="loadServerBtn" class="btn btn-primary w-full">
                    üîç Charger les salons du serveur
                </button>
                <div id="serverError" class="alert alert-error hidden"></div>
            </div>
        </div>

        <!-- Channel Selection -->
        <div id="channelView" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">5. Choisissez un salon</h2>
                <p class="card-description">S√©lectionnez le salon o√π envoyer le contenu</p>
            </div>
            <div class="card-content space-y-4">
                <div id="channelsList" class="max-h-64 overflow-y-auto">
                    <!-- Les salons seront charg√©s ici -->
                </div>
                <button id="sendBtn" class="btn btn-primary w-full" disabled>
                    üì§ Envoyer au bot Discord
                </button>
                <div id="sendError" class="alert alert-error hidden"></div>
            </div>
        </div>

        <!-- Status Badges -->
        <div class="flex flex-wrap gap-2 justify-center">
            <span id="categoryBadge" class="badge badge-inactive">Cat√©gorie: Non s√©lectionn√©e</span>
            <span id="weekBadge" class="badge badge-inactive">Option: Non s√©lectionn√©e</span>
            <span id="serverBadge" class="badge badge-inactive">Serveur: Non s√©lectionn√©</span>
            <span id="channelBadge" class="badge badge-inactive">Salon: Non s√©lectionn√©</span>
        </div>
    </div>

    <script>
    console.log('üöÄ D√©marrage de l\'application...');
    
    // Configuration Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDuY1T6HaxfDbEcZZYOrpDcD5LPNUTmeUc",
        authDomain: "godplace-dea67.firebaseapp.com",
        projectId: "godplace-dea67",
        storageBucket: "godplace-dea67.firebasestorage.app",
        messagingSenderId: "774010087004",
        appId: "1:774010087004:web:31346dfbc1b2adfed2e899",
        measurementId: "G-HNXY5FDSZK"
    };

    console.log('üìä Configuration Firebase:', firebaseConfig);

    // V√©rifier si Firebase est charg√©
    if (typeof firebase === 'undefined') {
        console.error('‚ùå Firebase n\'est pas charg√© !');
        alert('Erreur: Firebase n\'est pas charg√©. V√©rifiez votre connexion internet.');
    } else {
        console.log('‚úÖ Firebase est charg√©');
    }

    // Initialiser Firebase
    try {
        firebase.initializeApp(firebaseConfig);
        console.log('‚úÖ Firebase initialis√© avec succ√®s');
    } catch (error) {
        console.error('‚ùå Erreur initialisation Firebase:', error);
        alert('Erreur Firebase: ' + error.message);
    }

    const auth = firebase.auth();
    const db = firebase.firestore();

    console.log('üîê Auth:', auth);
    console.log('üóÑÔ∏è Firestore:', db);

    // Configuration
    const ADMIN_EMAILS = [
        "guylann.couvri@gmail.com",
        "cineustaci@gmail.com",
        "elyna933@gmail.com"
    ];

    const MODO_EMAILS = [
        "modo1@example.com",
        "modo2@example.com"
    ];

    // ‚ö†Ô∏è REMPLACEZ PAR VOTRE TOKEN DE BOT
    const BOT_TOKEN = 'MTM2NTQyNjA0MzUzNTYyNjM2MQ.GVj5Zm.j-In9IJM9Z7Mvc5vUJ8yAu7OShPiDLwDY9ok5c';

    // Variables globales
    let currentUser = null;
    let userDiscordPseudo = '';
    let isAdmin = false;
    let isModo = false;
    let currentView = 'main';
    let selectedCategory = '';
    let selectedGame = '';
    let selectedWeek = '';
    let selectedChannel = '';
    let selectedChannelName = '';
    let selectedServerId = '';
    let selectedServerName = '';
    let selectedImage = '';
    let isLoading = false;
    let availableChannels = [];

    // Donn√©es des cat√©gories (gardez les m√™mes donn√©es que dans votre code)
    const categories = {
        mondeEnDeclin: {
            title: "Le Monde en D√©clin",
            weeks: {
                "Semaine 1": "https://media.discordapp.net/attachments/1365412596655853699/1365725262414876693/FICHES_SPECIFIQUES_PETIT_FORMAT_-_4.png",
                "Semaine 2": "https://media.discordapp.net/attachments/1365412596655853699/1365725295369388042/FICHES_SPECIFIQUES_PETIT_FORMAT_-_5.png",
                "Semaine 3": "https://media.discordapp.net/attachments/1365412596655853699/1365725348314222754/FICHES_SPECIFIQUES_PETIT_FORMAT_-_6.png"
            }
        },
        // ... (gardez toutes vos autres cat√©gories)
        Bandeaux: {
            title: "Bandeaux",
            weeks: {
                "√† vos solutions": "https://media.discordapp.net/attachments/1365412596655853699/1365449720411062312/BANDEAUX_-_27.png",
                "Place au challenge": "https://media.discordapp.net/attachments/1365412596655853699/1365449778531537029/BANDEAUX_-_19.png"
            }
        }
    };

    const gameCategories = {
        grilleDeLumiere: {
            title: "Grille de lumi√®re",
            buttons: {
                "Grille de lumi√®re 1": "https://media.discordapp.net/attachments/1365412596655853699/1381746959072628826/PLATEAUX_CODES_SACRES_-_3.png"
            }
        }
    };

    // √âl√©ments DOM
    const elements = {
        loadingScreen: document.getElementById('loadingScreen'),
        authScreen: document.getElementById('authScreen'),
        mainPanel: document.getElementById('mainPanel'),
        loginForm: document.getElementById('loginForm'),
        registerForm: document.getElementById('registerForm'),
        authError: document.getElementById('authError'),
        authSuccess: document.getElementById('authSuccess'),
        userEmail: document.getElementById('userEmail'),
        userDiscord: document.getElementById('userDiscord'),
        adminBadge: document.getElementById('adminBadge'),
        modoBadge: document.getElementById('modoBadge'),
        logoutBtn: document.getElementById('logoutBtn'),
        logsSection: document.getElementById('logsSection'),
        authorizedUsersSection: document.getElementById('authorizedUsersSection'),
        authorizedUsersList: document.getElementById('authorizedUsersList'),
        newUserPseudo: document.getElementById('newUserPseudo'),
        addUserBtn: document.getElementById('addUserBtn'),
        mainView: document.getElementById('mainView'),
        gamesView: document.getElementById('gamesView'),
        weekView: document.getElementById('weekView'),
        previewView: document.getElementById('previewView'),
        serverView: document.getElementById('serverView'),
        serverIdInput: document.getElementById('serverIdInput'),
        loadServerBtn: document.getElementById('loadServerBtn'),
        serverError: document.getElementById('serverError'),
        channelView: document.getElementById('channelView'),
        channelsList: document.getElementById('channelsList'),
        backBtn: document.getElementById('backBtn'),
        categorySelect: document.getElementById('categorySelect'),
        weekButtons: document.getElementById('weekButtons'),
        weekDescription: document.getElementById('weekDescription'),
        previewImage: document.getElementById('previewImage'),
        sendBtn: document.getElementById('sendBtn'),
        sendError: document.getElementById('sendError'),
        testBtn: document.getElementById('testBtn'),
        logs: document.getElementById('logs'),
        categoryBadge: document.getElementById('categoryBadge'),
        weekBadge: document.getElementById('weekBadge'),
        serverBadge: document.getElementById('serverBadge'),
        channelBadge: document.getElementById('channelBadge')
    };

    console.log('üéØ √âl√©ments DOM charg√©s:', Object.keys(elements).length);

    // Fonctions utilitaires
    function showElement(element) {
        if (element) {
            element.classList.remove('hidden');
        } else {
            console.error('‚ùå √âl√©ment non trouv√© pour showElement');
        }
    }

    function hideElement(element) {
        if (element) {
            element.classList.add('hidden');
        } else {
            console.error('‚ùå √âl√©ment non trouv√© pour hideElement');
        }
    }

    function showError(message) {
        console.log('‚ùå Erreur:', message);
        if (elements.authError) {
            elements.authError.textContent = message;
            showElement(elements.authError);
            hideElement(elements.authSuccess);
        }
    }

    function showSuccess(message) {
        console.log('‚úÖ Succ√®s:', message);
        if (elements.authSuccess) {
            elements.authSuccess.textContent = message;
            showElement(elements.authSuccess);
            hideElement(elements.authError);
        }
    }

    function clearMessages() {
        hideElement(elements.authError);
        hideElement(elements.authSuccess);
    }

    function showAuthScreen() {
        console.log('üîê Affichage √©cran d\'authentification');
        hideElement(elements.loadingScreen);
        showElement(elements.authScreen);
        hideElement(elements.mainPanel);
    }

    function showMainPanel() {
        console.log('üè† Affichage panneau principal');
        hideElement(elements.loadingScreen);
        hideElement(elements.authScreen);
        showElement(elements.mainPanel);

        // Afficher les informations utilisateur
        if (elements.userEmail && currentUser) {
            elements.userEmail.textContent = currentUser.email;
        }
        if (elements.userDiscord) {
            elements.userDiscord.textContent = `Discord: ${userDiscordPseudo}`;
        }

        // G√©rer les badges et permissions
        if (isAdmin) {
            showElement(elements.adminBadge);
            hideElement(elements.modoBadge);
            showElement(elements.logsSection);
            showElement(elements.authorizedUsersSection);
        } else if (isModo) {
            hideElement(elements.adminBadge);
            showElement(elements.modoBadge);
            showElement(elements.logsSection);
            showElement(elements.authorizedUsersSection);
        } else {
            hideElement(elements.adminBadge);
            hideElement(elements.modoBadge);
            hideElement(elements.logsSection);
            hideElement(elements.authorizedUsersSection);
        }
    }

    // Fonctions d'authentification
    function checkUserRole(email) {
        const isAdminUser = ADMIN_EMAILS.includes(email);
        const isModoUser = MODO_EMAILS.includes(email);
        console.log('üë§ V√©rification r√¥le pour', email, '- Admin:', isAdminUser, '- Modo:', isModoUser);
        return { isAdmin: isAdminUser, isModo: isModoUser };
    }

    // Observer d'authentification avec timeout de s√©curit√©
    console.log('üîÑ Configuration de l\'observer d\'authentification...');
    
    // Timeout de s√©curit√© pour √©viter le chargement infini
    setTimeout(() => {
        if (elements.loadingScreen && !elements.loadingScreen.classList.contains('hidden')) {
            console.error('‚è∞ Timeout: Chargement trop long, affichage forc√© de l\'√©cran d\'auth');
            showAuthScreen();
        }
    }, 10000); // 10 secondes max

    try {
        auth.onAuthStateChanged(async (user) => {
            console.log('üîÑ Changement d\'√©tat d\'authentification:', user ? 'Connect√©' : 'D√©connect√©');
            
            if (user) {
                console.log('üë§ Utilisateur connect√©:', user.email);
                currentUser = user;
                const roles = checkUserRole(user.email);
                isAdmin = roles.isAdmin;
                isModo = roles.isModo;

                const savedPseudo = localStorage.getItem('discordPseudo');
                if (savedPseudo) {
                    userDiscordPseudo = savedPseudo;
                    console.log('üíæ Pseudo Discord r√©cup√©r√©:', savedPseudo);
                }
                showMainPanel();
            } else {
                console.log('üö™ Aucun utilisateur connect√©');
                showAuthScreen();
            }
        });
    } catch (error) {
        console.error('‚ùå Erreur observer auth:', error);
        showAuthScreen();
    }

    // Event listeners de base
    document.addEventListener('DOMContentLoaded', () => {
        console.log('üìÑ DOM charg√©');
    });

    // Gestion des onglets d'authentification
    document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
            console.log('üìë Changement d\'onglet:', e.target.dataset.tab);
            const tabName = e.target.dataset.tab;
            
            // Mettre √† jour les onglets
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            e.target.classList.add('active');

            // Afficher le bon formulaire
            if (tabName === 'login') {
                showElement(elements.loginForm);
                hideElement(elements.registerForm);
            } else {
                hideElement(elements.loginForm);
                showElement(elements.registerForm);
            }

            clearMessages();
        });
    });

    // Event listeners pour l'authentification
    if (elements.loginForm) {
        elements.loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            console.log('üîê Tentative de connexion...');
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const discordPseudo = document.getElementById('loginDiscordPseudo').value;

            console.log('üìß Email:', email);
            console.log('üéÆ Discord:', discordPseudo);

            clearMessages();
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                console.log('‚úÖ Connexion r√©ussie');
                userDiscordPseudo = discordPseudo;
                localStorage.setItem('discordPseudo', discordPseudo);
            } catch (error) {
                console.error('‚ùå Erreur connexion:', error);
                showError(`Erreur de connexion: ${error.message}`);
            }
        });
    }

    if (elements.logoutBtn) {
        elements.logoutBtn.addEventListener('click', async () => {
            console.log('üö™ D√©connexion...');
            try {
                await auth.signOut();
                localStorage.removeItem('discordPseudo');
                userDiscordPseudo = '';
                currentUser = null;
                isAdmin = false;
                isModo = false;
            } catch (error) {
                console.error('‚ùå Erreur d√©connexion:', error);
            }
        });
    }

    console.log('üéâ Initialisation termin√©e');
</script>
</body>
</html>
